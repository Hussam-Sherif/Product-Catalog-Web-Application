@{
    ViewData["Title"] = "Welcome To Myproduct";
}
@model IEnumerable<Product>

<div class="container-fluid py-5" style="background-color: #0a4275;">
    <div class="row align-items-center">
        <div class="col-md-6 text-center text-md-end mb-4 mb-md-0">
            <h1 class="display-6 text-light">Welcome To Product Catalog</h1>
        </div>
    </div>
</div>
<div class="alert alert-dismissible bg-light-info border border-info border-3 border-dashed d-flex justify-content-between w-auto p-1 m-2">
    <!--begin::Icon-->
    <div class="d-flex align-items-center">
        <span class="svg-icon svg-icon-2hx svg-icon-info me-4 mb-5 mb-sm-0">
            <span class="svg-icon svg-icon-2">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 122.88 101.37" style="enable-background:new 0 0 122.88 101.37" xml:space="preserve"><g><path d="M12.64,77.27l0.31-54.92h-6.2v69.88c8.52-2.2,17.07-3.6,25.68-3.66c7.95-0.05,15.9,1.06,23.87,3.76 c-4.95-4.01-10.47-6.96-16.36-8.88c-7.42-2.42-15.44-3.22-23.66-2.52c-1.86,0.15-3.48-1.23-3.64-3.08 C12.62,77.65,12.62,77.46,12.64,77.27L12.64,77.27z M103.62,19.48c-0.02-0.16-0.04-0.33-0.04-0.51c0-0.17,0.01-0.34,0.04-0.51V7.34 c-7.8-0.74-15.84,0.12-22.86,2.78c-6.56,2.49-12.22,6.58-15.9,12.44V85.9c5.72-3.82,11.57-6.96,17.58-9.1 c6.85-2.44,13.89-3.6,21.18-3.02V19.48L103.62,19.48z M110.37,15.6h9.14c1.86,0,3.37,1.51,3.37,3.37v77.66 c0,1.86-1.51,3.37-3.37,3.37c-0.38,0-0.75-0.06-1.09-0.18c-9.4-2.69-18.74-4.48-27.99-4.54c-9.02-0.06-18.03,1.53-27.08,5.52 c-0.56,0.37-1.23,0.57-1.92,0.56c-0.68,0.01-1.35-0.19-1.92-0.56c-9.04-4-18.06-5.58-27.08-5.52c-9.25,0.06-18.58,1.85-27.99,4.54 c-0.34,0.12-0.71,0.18-1.09,0.18C1.51,100.01,0,98.5,0,96.64V18.97c0-1.86,1.51-3.37,3.37-3.37h9.61l0.06-11.26 c0.01-1.62,1.15-2.96,2.68-3.28l0,0c8.87-1.85,19.65-1.39,29.1,2.23c6.53,2.5,12.46,6.49,16.79,12.25 c4.37-5.37,10.21-9.23,16.78-11.72c8.98-3.41,19.34-4.23,29.09-2.8c1.68,0.24,2.88,1.69,2.88,3.33h0V15.6L110.37,15.6z M68.13,91.82c7.45-2.34,14.89-3.3,22.33-3.26c8.61,0.05,17.16,1.46,25.68,3.66V22.35h-5.77v55.22c0,1.86-1.51,3.37-3.37,3.37 c-0.27,0-0.53-0.03-0.78-0.09c-7.38-1.16-14.53-0.2-21.51,2.29C79.09,85.15,73.57,88.15,68.13,91.82L68.13,91.82z M58.12,85.25 V22.46c-3.53-6.23-9.24-10.4-15.69-12.87c-7.31-2.8-15.52-3.43-22.68-2.41l-0.38,66.81c7.81-0.28,15.45,0.71,22.64,3.06 C47.73,78.91,53.15,81.64,58.12,85.25L58.12,85.25z" fill="currentColor"></path></g></svg>
            </span>
        </span>
        <!--begin::Content-->
        <div class="d-flex flex-column pe-0 pe-sm-10">
            <h5 class="mb-1">List of Products</h5>
        </div>
    </div>
    <div>
        <a class="btn btn-primary " href="/Product/Create">
            Create
        </a>

    </div>
    <!--end::Close-->

</div>
<div class="container mt-4">
    <div class="card shadow">
        <div class="card-body">
            <table class="table table-hover" id="table" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Created By</th>
                        <th>Price</th>
                        <th>Start date</th>
                        <th>Duration</th>
                        <th>Categories</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var product in Model)
                    {
                        <tr class="ParentClass">
                            <td>
                                <div class="media">
                                    <div class="media-body">
                                        <h5 class="mt-0">
                                            <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ID">
                                                @product.Name
                                            </a>
                                        </h5>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    
                                    <span class="badge bg-primary text-white">@product.CreatedById</span>
                                </div>
                            </td>
                            <td>
                                <div class="mb-2">
                                    <strong>Price is:</strong>
                                    <span class="badge bg-primary text-white">@product.Price</span>
                                </div>
                            </td>
                            <td>
                                <div class="mb-2">
                                    <strong>Start date at:</strong>

                                    @{
                                        if (@product.StartDate > DateTime.Now)
                                        {
                                            <span class="badge bg-warning text-white">@product.StartDate.ToString("MM/dd/yyyy")</span>
                                        }
                                        else if (@product.StartDate <= DateTime.Now && @product.StartDate.AddDays(@product.Duration) >= DateTime.Now)
                                        {
                                            <span class="badge bg-primary text-white">@product.StartDate.ToString("MM/dd/yyyy")</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger text-white">@product.StartDate.ToString("MM/dd/yyyy")</span>
                                        }
                                    }
                                    
                                    
                                </div>
                            </td>
                            <td>
                                <div class="mb-2">
                                    <strong>Duration will be:</strong>
                                    <span class="badge bg-primary text-white">
                                        @{
                                            var endDate = product.StartDate.AddDays(product.Duration);
                                        }
                                        @endDate.ToString("MM/dd/yyyy")
                                    </span>
                                </div>
                            </td>
                            <td>
                                <p class="mb-0">
                                    @foreach (var item in product.Categories)
                                    {
                                        <span class="badge bg-info">@item.Category!.Name</span><br />
                                    }
                                </p>
                            </td>
                            <td>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span class="svg-icon svg-icon-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <rect x="5" y="5" width="5" height="5" rx="1" fill="currentColor"></rect>
                                                    <rect x="14" y="5" width="5" height="5" rx="1" fill="currentColor" opacity="0.3"></rect>
                                                    <rect x="5" y="14" width="5" height="5" rx="1" fill="currentColor" opacity="0.3"></rect>
                                                    <rect x="14" y="14" width="5" height="5" rx="1" fill="currentColor" opacity="0.3"></rect>
                                                </g>
                                            </svg>
                                        </span>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-end">
                                        <h6 class="dropdown-header">Quick Actions</h6>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" asp-controller="Product" asp-action="Edit" asp-route-id="@product.ID">Edit</a>
                                        <a class="dropdown-item js-delete" href="javascript:;" data-id="@product.ID">Delete Product</a>
                                    </div>
                                </div>
                            </td>
                        </tr>




                    }
                </tbody>
                
            </table>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        $(document).ready(function () {
            var table = $('#table').DataTable({
                "pagingType": "simple_numbers",
                stateSave: true,
                lengthMenu: [5,10, 15, 20, 25],
                "language": {
                    "paginate": {
                        "previous": "&lt;", // Custom "Previous" button label
                        "next": "&gt;" // Custom "Next" button label
                    }
                }
            });

            // Redraw the table to apply the custom pagination styling
            table.on('draw.dt', function () {
                table.$('.paginate_button').addClass('current');
            });

            $('.js-delete').on('click', function () {
                var btn = $(this);
                console.log("Hello");
                bootbox.confirm({
                    message: 'This is a confirm with custom button text and color! Do you like it?',
                    buttons: {
                        confirm: {
                            label: 'Yes',
                            className: 'btn-danger'
                        },
                        cancel: {
                            label: 'No',
                            className: 'btn-success'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            $.ajax({
                                url: '/Product/Delete/' + btn.data('id'),
                                success: function () {
                                    btn.parents('.ParentClass').fadeOut();
                                    toastr.success('Movie Deleted successfully!');
                                },
                                error: function () {
                                    toastr.error('Something Went Wrong!');
                                },
                            });
                        }
                    }
                });

            });
        });
    </script>
}
